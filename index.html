<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sharif.com — E-commerce</title>
    <style>
        :root {
            --brand: #007bff;
            --bg: #f5f6f8;
            --text: #222;
            --card: #fff;
            --danger: #dc3545;
            --success: #28a745;
            --dark-bg: #1a1a1a;
            --dark-text: #f5f6f8;
            --dark-card: #2c2c2c;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; transition: background 0.3s, color 0.3s; }
        body[dir="rtl"] { text-align: right; }
        body[dir="ltr"] { text-align: left; }
        
        /* Dark Mode */
        body.dark-mode { --bg: var(--dark-bg); --text: var(--dark-text); --card: var(--dark-card); }
        body.dark-mode header { background: #0056b3; }
        body.dark-mode .card, body.dark-mode #cartPanel, body.dark-mode #orderFormContent, body.dark-mode #passwordPromptContent, body.dark-mode #loginForm div { background: var(--card); color: var(--text); }
        body.dark-mode .description { color: #ccc; }
        
        /* Header & Navigation */
        header { background: var(--brand); color: #fff; padding: 15px; position: sticky; top: 0; box-shadow: 0 2px 5px rgba(0,0,0,0.1); z-index: 100; display: flex; justify-content: space-between; align-items: center; }
        .nav { display: flex; align-items: center; gap: 15px; }
        .logo { font-weight: bold; font-size: 22px; }
        .language-selector { display: flex; gap: 10px; }
        .lang-btn { background: transparent; color: white; border: 1px solid white; border-radius: 5px; padding: 5px 10px; cursor: pointer; font-size: 12px; }
        .lang-btn.active { background: white; color: var(--brand); }
        .btn { background: #fff; color: var(--brand); border: 0; border-radius: 5px; padding: 8px 15px; cursor: pointer; font-weight: bold; transition: all 0.3s; }
        .btn:hover { opacity: 0.9; }
        .btn.ghost { background: transparent; color: #fff; border: 1px solid #fff; }
        .btn.danger { background: var(--danger); color: #fff; }
        .btn.success { background: var(--success); color: #fff; }
        .menu-btn { display: none; background: none; border: none; color: white; font-size: 24px; cursor: pointer; }
        .three-line-menu { display: flex; gap: 15px; }
        .three-line-menu button { background: none; border: none; color: white; cursor: pointer; font-size: 16px; padding: 5px 10px; }
        .three-line-menu button:hover { text-decoration: underline; }
        
        /* Main Content */
        .wrap { padding: 20px; max-width: 1200px; margin: 0 auto; }
        .page { display: none; }
        .page.active { display: block; }
        .setgrid { display: grid; grid-template-columns: 1fr; gap: 15px; margin: 20px 0; }
        .setgrid input, .setgrid textarea, .setgrid select { width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ddd; font-family: inherit; }
        .setgrid textarea { min-height: 100px; resize: vertical; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .card { background: var(--card); border-radius: 10px; padding: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); transition: transform 0.3s; }
        .card:hover { transform: translateY(-5px); }
        .card img { width: 100%; height: 200px; object-fit: contain; margin-bottom: 10px; border-radius: 5px; }
        .title { font-weight: bold; margin: 10px 0; font-size: 18px; }
        .price { font-size: 18px; font-weight: bold; color: var(--brand); margin: 10px 0; }
        .description { color: #666; margin: 10px 0; font-size: 14px; }
        .product-actions { display: flex; gap: 10px; margin-top: 15px; }
        .product-actions button { flex: 1; }
        
        /* Settings Page */
        #settingsOptions { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
        #settingsOptions .btn { flex-grow: 1; }
        .settings-section { border-top: 1px solid #eee; padding-top: 20px; margin-top: 20px; }

        /* Cart & Modals */
        #cartPanel { display: none; position: fixed; top: 0; right: 0; width: 350px; height: 100%; background: #fff; padding: 20px; box-shadow: -2px 0 10px rgba(0,0,0,0.1); overflow-y: auto; z-index: 1000; }
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; align-items: center; justify-content: center; }
        .modal-content { background: #fff; padding: 30px; width: 90%; max-width: 500px; border-radius: 10px; position: relative; }
        .close-btn { position: absolute; top: 10px; right: 10px; background: var(--danger); color: white; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-weight: bold; line-height: 30px; text-align: center; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .grid { grid-template-columns: 1fr; }
            .nav { position: fixed; top: 67px; right: -100%; background: var(--brand); width: 250px; height: 100vh; flex-direction: column; align-items: flex-start; padding: 20px; transition: right 0.3s ease-in-out; }
            .nav.active { right: 0; }
            .menu-btn { display: block; }
            .three-line-menu { display: none; }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo" id="storeName" data-en="Sharif.com" data-ur="شریف ڈاٹ کام" data-mm="ရှရစ်ဒတ်ကွမ်">Sharif.com</div>
        <div class="three-line-menu">
            <button onclick="showPage('home')" data-en="Home" data-ur="ہوم" data-mm="ပင်မစာမျက်နှာ">Home</button>
            <button onclick="showPage('settings')" data-en="Settings" data-ur="ترتیبات" data-mm="ဆက်တင်များ">Settings</button>
        </div>
        <nav class="nav" id="mainNav">
            <button class="btn ghost" onclick="toggleCart()" data-en="View Cart" data-ur="کارٹ دیکھیں" data-mm="စျေးခြင်းတောင်းကြည့်ရန်">View Cart</button>
            <button class="btn ghost" id="loginBtn" data-en="Login" data-ur="لاگ ان" data-mm="ဝင်ရောက်ပါ">Login</button>
            <div class="language-selector">
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="ur">اردو</button>
                <button class="lang-btn" data-lang="mm">မြန်မာ</button>
            </div>
             <button class="btn ghost" onclick="toggleDarkMode()" id="darkModeToggle" aria-label="Toggle Dark Mode">🌙</button>
        </nav>
        <button class="menu-btn" onclick="toggleMobileMenu()">☰</button>
    </header>

    <main class="wrap">
        <section id="pageHome" class="page active">
            <h2 data-en="Our Products" data-ur="ہماری مصنوعات" data-mm="ကျွန်ုပ်တို့၏ထုတ်ကုန်များ">Our Products</h2>
            <div class="setgrid">
                <input type="text" id="searchInput" placeholder="Search products..." data-en="Search products..." data-ur="مصنوعات تلاش کریں..." data-mm="ထုတ်ကုန်များရှာဖွေပါ...">
                <select id="filterSelect">
                    <option value="all" data-en="All" data-ur="تمام" data-mm="အားလုံး">All</option>
                    <option value="priceLow" data-en="Price: Low to High" data-ur="قیمت: کم سے زیادہ" data-mm="စျေးနှုန်း: နိမ့်မှမြင့်သို့">Price: Low to High</option>
                    <option value="priceHigh" data-en="Price: High to Low" data-ur="قیمت: زیادہ سے کم" data-mm="စျေးနှုန်း: မြင့်မှနိမ့်သို့">Price: High to Low</option>
                </select>
            </div>
            <div class="grid" id="productsGrid"></div>
            <div class="wish-list" id="wishList"></div>
        </section>

        <section id="pageSettings" class="page">
            <div id="settingsOptions">
                <button class="btn" onclick="toggleSection('userProfileSection')" data-en="Your Profile" data-ur="آپ کا پروفائل" data-mm="သင့်ပရိုဖိုင်">Your Profile</button>
                <button class="btn" onclick="toggleSection('createSellerSection')" data-en="Create Seller Account" data-ur="سیلر اکاؤنٹ بنائیں" data-mm="ရောင်းချသူအကောင့်ဖန်တီးပါ">Create Seller Account</button>
                <button class="btn" onclick="toggleSection('addressBookSection')" data-en="Book Your Address" data-ur="اپنا پتہ بک کریں" data-mm="သင့်လိပ်စာကိုမှတ်ပါ">Book Your Address</button>
                <button class="btn" onclick="showPasswordPrompt('adminPanelSection')" data-en="Admin Control Panel" data-ur="ایڈمن کنٹرول پینل" data-mm="အက်ဒမင်ထိန်းချုပ်ရေးဘုတ်အဖွဲ့">Admin Control Panel</button>
            </div>

            <div id="userProfileSection" class="settings-section" style="display: none;">
                <h2 data-en="Your Profile" data-ur="آپ کا پروفائل" data-mm="သင့်ပရိုဖိုင်">Your Profile</h2>
                <div id="profileForm" class="setgrid">
                    <input type="text" placeholder="Name" id="profileNameInput" data-en="Name" data-ur="نام" data-mm="နာမည်">
                    <input type="email" placeholder="Email" id="profileEmailInput" data-en="Email" data-ur="ای میل" data-mm="အီးမေးလ်">
                    <input type="tel" placeholder="Phone" id="profilePhoneInput" data-en="Phone" data-ur="فون" data-mm="ဖုန်း">
                    <textarea placeholder="Full Address" id="profileAddressInput" data-en="Full Address" data-ur="مکمل پتہ" data-mm="လိပ်စာအပြည့်အစုံ"></textarea>
                    <input type="password" placeholder="Password" id="profilePasswordInput" data-en="Password" data-ur="پاس ورڈ" data-mm="စကားဝှက်">
                    <button class="btn success" onclick="saveProfile()" data-en="Create Profile" data-ur="پروفائل بنائیں" data-mm="ပရိုဖိုင်ဖန်တီးပါ">Create Profile</button>
                </div>
                <div id="profileDisplay" style="display: none;">
                    <p id="profileId"></p><p id="profileName"></p><p id="profileEmail"></p><p id="profilePhone"></p><p id="profileAddress"></p>
                </div>
            </div>
            
            <div id="createSellerSection" class="settings-section" style="display: none;">
                 <h2 data-en="Create Seller Account" data-ur="سیلر اکاؤنٹ بنائیں" data-mm="ရောင်းချသူအကောင့်ဖန်တီးပါ">Create Seller Account</h2>
                 </div>

            <div id="addressBookSection" class="settings-section" style="display: none;">
                <h2 data-en="Address Book" data-ur="ایڈریس بک" data-mm="လိပ်စာစာအုပ်">Address Book</h2>
                </div>

            <div id="adminPanelSection" class="settings-section" style="display: none;">
                <h2 data-en="Admin Control Panel" data-ur="ایڈمن کنٹرول پینل" data-mm="အက်ဒမင်ထိန်းချုပ်ရေးဘုတ်အဖွဲ့">Admin Control Panel</h2>
                <h3 data-en="Store Settings" data-ur="اسٹور ترتیبات" data-mm="ဆိုင်ဆက်တင်များ">Store Settings</h3>
                <div class="setgrid">
                    <input type="text" placeholder="Store Name" id="setStoreName" data-en="Store Name" data-ur="اسٹور کا نام" data-mm="ဆိုင်နာမည်">
                    <input type="text" placeholder="Currency" id="setCurrency" data-en="Currency" data-ur="کرنسی" data-mm="ငွေကြေးယူနစ်">
                    <button class="btn" onclick="saveStoreSettings()" data-en="Save Settings" data-ur="ترتیبات محفوظ کریں" data-mm="ဆက်တင်များသိမ်းဆည်းပါ">Save Settings</button>
                </div>
                <h3 data-en="Product Management" data-ur="پروڈکٹ مینجمنٹ" data-mm="ထုတ်ကုန်စီမံခန့်ခွဲမှု">Product Management</h3>
                <div class="setgrid">
                    <input type="text" placeholder="Product Title" id="adminTitle" data-en="Product Title" data-ur="پروڈکٹ کا عنوان" data-mm="ထုတ်ကုန်ခေါင်းစဉ်">
                    <input type="text" placeholder="Brand" id="adminBrand" data-en="Brand" data-ur="برانڈ" data-mm="အမှတ်တံဆိပ်">
                    <textarea placeholder="Description" id="adminDescription" data-en="Description" data-ur="تفصیل" data-mm="ဖော်ပြချက်"></textarea>
                    <input type="number" placeholder="Price" id="adminPrice" data-en="Price" data-ur="قیمت" data-mm="စျေးနှုန်း">
                    <input type="text" placeholder="Image URL" id="imageUrlInput" data-en="Image URL" data-ur="امیج یو آر ایل" data-mm="ပုံ URL">
                    <button class="btn" onclick="showPasswordPrompt('addProduct')" data-en="Add Product" data-ur="پروڈکٹ شامل کریں" data-mm="ထုတ်ကုန်ထည့်ပါ">Add Product</button>
                </div>
                <h3 data-en="Current Products" data-ur="موجودہ مصنوعات" data-mm="လက်ရှိထုတ်ကုန်များ">Current Products</h3>
                <div class="grid" id="adminProductList"></div>
                <h3 data-en="Pending Seller Accounts" data-ur="زیر التواء سیلر اکاؤنٹس" data-mm="ဆိုင်းငံ့ထားသော ရောင်းချသူအကောင့်များ">Pending Seller Accounts</h3>
                <div class="grid" id="pendingSellers"></div>
            </div>
        </section>
    </main>

    <div id="cartPanel">
        <h3 data-en="Your Cart" data-ur="آپ کی کارٹ" data-mm="သင့်စျေးခြင်းတောင်း">Your Cart</h3>
        <div id="cartItems"></div>
        <div id="cartTotal" style="font-weight: bold; margin: 15px 0;"></div>
        <button class="btn danger" onclick="clearCart()" data-en="Clear Cart" data-ur="کارٹ صاف کریں" data-mm="စျေးခြင်းတောင်းရှင်းလင်းပါ">Clear Cart</button>
        <button class="btn success" onclick="showOrderForm()" data-en="Order Now" data-ur="ابھی آرڈر کریں" data-mm="ယခုမှာယူပါ">Order Now</button>
    </div>

    <div id="orderForm" class="modal-overlay">
        <div class="modal-content">
            <button class="close-btn" onclick="hideOrderForm()">×</button>
            <h3 data-en="Order Details" data-ur="آرڈر کی تفصیلات" data-mm="အော်ဒါအသေးစိတ်">Order Details</h3>
            <form id="orderFormDetails">
                <div id="orderSummary"></div>
                <button type="submit" class="btn success" style="width: 100%;" data-en="Place Order" data-ur="آرڈر دیں" data-mm="အော်ဒါတင်ပါ">Place Order</button>
            </form>
        </div>
    </div>
    
    <div id="loginForm" class="modal-overlay">
        <div class="modal-content" style="max-width: 400px;">
            <button class="close-btn" onclick="hideLoginForm()">×</button>
            <h3 data-en="Login" data-ur="لاگ ان" data-mm="ဝင်ရောက်ပါ">Login</h3>
            <input type="email" id="loginEmail" placeholder="Email" required style="width: 100%; padding: 10px; margin-bottom: 10px;">
            <input type="password" id="loginPassword" placeholder="Password" required style="width: 100%; padding: 10px; margin-bottom: 10px;">
            <button class="btn" onclick="loginUser()" style="width: 100%;">Login</button>
        </div>
    </div>

    <div id="passwordPrompt" class="modal-overlay">
        <div class="modal-content" style="max-width: 400px; text-align: center;">
            <h3 data-en="Admin Password Required" data-ur="ایڈمن پاس ورڈ درکار ہے" data-mm="အက်ဒမင်စကားဝှက်လိုအပ်သည်">Admin Password Required</h3>
            <input type="password" id="adminPasswordInput" placeholder="Enter password" data-en="Enter password" data-ur="پاس ورڈ درج کریں" data-mm="စကားဝှက်ထည့်ပါ" style="width: 100%; padding: 10px; margin: 15px 0;">
            <div style="display: flex; gap: 10px;">
                <button class="btn" onclick="verifyPassword()" style="flex: 1;" data-en="Verify" data-ur="تصدیق کریں" data-mm="အတည်ပြုပါ">Verify</button>
                <button class="btn danger" onclick="hidePasswordPrompt()" style="flex: 1;" data-en="Cancel" data-ur="منسوخ کریں" data-mm="ပယ်ဖျက်ပါ">Cancel</button>
            </div>
            <p id="passwordError" style="color: red; margin-top: 10px; display: none;">Wrong password!</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
    <script>
    // JAVASCRIPT CODE STARTS HERE
    (function() {
        emailjs.init("DapdU3gPmJ8ymUdD2");
    })();

    // === CONFIGURATION & GLOBAL VARIABLES ===
    const ADMIN_PASSWORD = '@122@44@good';
    const ADMIN_EMAIL = 'ashraf97941@gmail.com';
    const API_KEY = 'patospSjmDLHmHPCk.13a17b94f962ff76abbd9ce0165fce6dbe2fa8fea723ebd6cbfb2dad98bfa83d';
    const BASE_ID = 'app3bPSMkXnHaooyU';
    
    const PRODUCTS_API = `https://api.airtable.com/v0/${BASE_ID}/My%20product`;
    const ORDERS_API = `https://api.airtable.com/v0/${BASE_ID}/Orders`;
    const USERS_API = `https://api.airtable.com/v0/${BASE_ID}/Users`; // For user profiles
    const SELLERS_API = `https://api.airtable.com/v0/${BASE_ID}/Seller%20accounts`;

    let products = [];
    let users = [];
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    let settings = JSON.parse(localStorage.getItem('settings')) || { storeName: 'Sharif.com', currency: '₹' };
    let currentLanguage = localStorage.getItem('language') || 'en';
    let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
    let currentAction = { action: '', data: null };
    
    // === INITIALIZATION ===
    document.addEventListener('DOMContentLoaded', async () => {
        // Load data from APIs
        await loadProductsFromAPI();
        await loadUsersFromAPI();
        
        // Initial UI setup
        setupEventListeners();
        updateStoreName();
        renderProducts();
        renderAdminProducts();
        renderCart();
        updateUserUI();
        applyDarkMode();
        updateLanguage();
    });

    // === CORE API FUNCTIONS ===
    async function apiRequest(url, method = 'GET', body = null) {
        const headers = {
            'Authorization': `Bearer ${API_KEY}`,
            'Content-Type': 'application/json'
        };
        const options = { method, headers };
        if (body) {
            options.body = JSON.stringify(body);
        }
        try {
            const response = await fetch(url, options);
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(`API Error: ${errorData.error.message}`);
            }
            return method === 'DELETE' ? response.ok : response.json();
        } catch (error) {
            console.error(`Error with ${method} request to ${url}:`, error);
            alert(`An error occurred: ${error.message}`);
            return null;
        }
    }
    
    async function loadProductsFromAPI() {
        const data = await apiRequest(PRODUCTS_API);
        if (data && data.records) {
            products = data.records.map(r => ({ ...r.fields, id: r.id }));
        }
    }

    async function loadUsersFromAPI() {
        const data = await apiRequest(USERS_API);
        if (data && data.records) {
            users = data.records.map(r => ({ ...r.fields, id: r.id }));
        }
    }
    
    // === USER INTERFACE & EXPERIENCE ===
    function setupEventListeners() {
        // Language buttons
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                currentLanguage = btn.dataset.lang;
                localStorage.setItem('language', currentLanguage);
                document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                updateLanguage();
            });
        });
        
        // Search and Filter
        document.getElementById('searchInput').addEventListener('input', renderProducts);
        document.getElementById('filterSelect').addEventListener('change', renderProducts);

        // Login Button
        document.getElementById('loginBtn').addEventListener('click', () => {
            if (currentUser) logoutUser();
            else showLoginForm();
        });
    }

    function updateLanguage() {
        document.body.dir = currentLanguage === 'ur' ? 'rtl' : 'ltr';
        document.querySelectorAll('[data-en]').forEach(el => {
            const text = el.dataset[currentLanguage] || el.dataset.en;
            if (el.placeholder !== undefined) el.placeholder = text;
            else el.textContent = text;
        });
        document.title = `${settings.storeName} — E-commerce`;
    }

    function toggleDarkMode() {
        document.body.classList.toggle('dark-mode');
        localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
    }

    function applyDarkMode() {
        if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark-mode');
        }
    }
    
    function showPage(pageId) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(`page${pageId.charAt(0).toUpperCase() + pageId.slice(1)}`).classList.add('active');
        if (window.innerWidth <= 768) toggleMobileMenu(); // Close menu on navigation
    }

    function toggleSection(sectionId) {
        const section = document.getElementById(sectionId);
        const isVisible = section.style.display === 'block';
        document.querySelectorAll('.settings-section').forEach(s => s.style.display = 'none');
        section.style.display = isVisible ? 'none' : 'block';
    }
    
    function toggleMobileMenu() {
        document.getElementById('mainNav').classList.toggle('active');
    }

    // === PRODUCT DISPLAY & MANAGEMENT ===
    function renderProducts() {
        const grid = document.getElementById('productsGrid');
        grid.innerHTML = '';
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const filter = document.getElementById('filterSelect').value;

        let filtered = products.filter(p => p.Name && p.Name.toLowerCase().includes(searchTerm));

        if (filter === 'priceLow') filtered.sort((a, b) => a.price - b.price);
        if (filter === 'priceHigh') filtered.sort((a, b) => b.price - a.price);

        filtered.forEach(p => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <img src="${p.image || 'https://via.placeholder.com/300'}" alt="${p.Name}">
                <div class="title">${p.Name}</div>
                <div class="description">${p.description || ''}</div>
                <div class="price">${settings.currency}${p.price || 0}</div>
                <div class="product-actions">
                    <button class="btn" onclick="addToCart('${p.id}')" data-en="Add to Cart" data-ur="کارٹ میں شامل کریں" data-mm="စျေးခြင်းတောင်းသို့ထည့်ပါ">Add to Cart</button>
                    <button class="btn success" onclick="buyNow('${p.id}')" data-en="Buy Now" data-ur="ابھی خریدیں" data-mm="ယခုဝယ်ပါ">Buy Now</button>
                </div>
            `;
            grid.appendChild(card);
        });
        updateLanguage(); // Apply translations to new buttons
    }
    
    function renderAdminProducts() {
        const list = document.getElementById('adminProductList');
        list.innerHTML = '';
        products.forEach(p => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <div class="title">${p.Name}</div>
                <div class="price">${settings.currency}${p.price}</div>
                <button class="btn danger" onclick="showPasswordPrompt('deleteProduct', '${p.id}')" data-en="Delete" data-ur="حذف کریں" data-mm="ဖျက်မည်">Delete</button>
            `;
            list.appendChild(card);
        });
    }

    async function addProduct() {
        const product = {
            Name: document.getElementById('adminTitle').value,
            brand: document.getElementById('adminBrand').value,
            description: document.getElementById('adminDescription').value,
            price: parseFloat(document.getElementById('adminPrice').value),
            image: document.getElementById('imageUrlInput').value,
        };
        
        if (!product.Name || !product.price) {
            alert('Product Name and Price are required.');
            return;
        }

        const result = await apiRequest(PRODUCTS_API, 'POST', { fields: product });
        if (result) {
            alert('Product added successfully!');
            await loadProductsFromAPI();
            renderProducts();
            renderAdminProducts();
        }
    }

    async function deleteProduct(productId) {
        const result = await apiRequest(`${PRODUCTS_API}/${productId}`, 'DELETE');
        if (result) {
            alert('Product deleted successfully!');
            await loadProductsFromAPI();
            renderProducts();
            renderAdminProducts();
        }
    }
    
    // === CART & ORDERING ===
    function addToCart(productId) {
        const item = cart.find(i => i.id === productId);
        if (item) {
            item.quantity++;
        } else {
            cart.push({ id: productId, quantity: 1 });
        }
        localStorage.setItem('cart', JSON.stringify(cart));
        renderCart();
        alert('Product added to cart!');
    }

    function buyNow(productId) {
        cart = [{ id: productId, quantity: 1 }];
        localStorage.setItem('cart', JSON.stringify(cart));
        renderCart();
        showOrderForm();
    }
    
    function renderCart() {
        const itemsDiv = document.getElementById('cartItems');
        const totalDiv = document.getElementById('cartTotal');
        itemsDiv.innerHTML = '';
        let total = 0;
        
        cart.forEach(item => {
            const product = products.find(p => p.id === item.id);
            if (product) {
                total += product.price * item.quantity;
                itemsDiv.innerHTML += `<p>${product.Name} (x${item.quantity}) - ${settings.currency}${product.price * item.quantity}</p>`;
            }
        });
        totalDiv.textContent = `Total: ${settings.currency}${total}`;
    }

    function clearCart() {
        if (confirm('Are you sure you want to clear the cart?')) {
            cart = [];
            localStorage.removeItem('cart');
            renderCart();
        }
    }
    
    function showOrderForm() { document.getElementById('orderForm').style.display = 'flex'; }
    function hideOrderForm() { document.getElementById('orderForm').style.display = 'none'; }
    
    // === USER AUTHENTICATION & PROFILE ===
    function updateUserUI() {
        const loginBtn = document.getElementById('loginBtn');
        if (currentUser) {
            loginBtn.dataset.en = "Logout";
            loginBtn.dataset.ur = "لاگ آؤٹ";
            loginBtn.dataset.mm = "ထွက်ပါ";
            loadProfile();
        } else {
            loginBtn.dataset.en = "Login";
            loginBtn.dataset.ur = "لاگ ان";
            loginBtn.dataset.mm = "ဝင်ရောက်ပါ";
            document.getElementById('profileDisplay').style.display = 'none';
            document.getElementById('profileForm').style.display = 'grid';
        }
        updateLanguage();
    }

    function showLoginForm() { document.getElementById('loginForm').style.display = 'flex'; }
    function hideLoginForm() { document.getElementById('loginForm').style.display = 'none'; }

    function loginUser() {
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        const user = users.find(u => u.Email === email && u.Password === password);
        
        if (user) {
            currentUser = user;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            updateUserUI();
            hideLoginForm();
            alert('Login successful!');
        } else {
            alert('Invalid credentials.');
        }
    }
    
    function logoutUser() {
        currentUser = null;
        localStorage.removeItem('currentUser');
        updateUserUI();
        alert('Logged out successfully.');
    }
    
    async function saveProfile() {
        const profileData = {
            Name: document.getElementById('profileNameInput').value,
            Email: document.getElementById('profileEmailInput').value,
            Phone: document.getElementById('profilePhoneInput').value,
            Address: document.getElementById('profileAddressInput').value,
            Password: document.getElementById('profilePasswordInput').value,
        };
        
        if (users.some(u => u.Email === profileData.Email)) {
            alert('An account with this email already exists.');
            return;
        }

        const result = await apiRequest(USERS_API, 'POST', { fields: profileData });
        if (result) {
            alert('Profile created successfully!');
            await loadUsersFromAPI();
            // Automatically log in the new user
            loginUser(profileData.Email, profileData.Password);
        }
    }
    
    function loadProfile() {
        if (currentUser) {
            document.getElementById('profileForm').style.display = 'none';
            document.getElementById('profileDisplay').style.display = 'block';
            document.getElementById('profileName').textContent = `Name: ${currentUser.Name}`;
            document.getElementById('profileEmail').textContent = `Email: ${currentUser.Email}`;
        }
    }

    // === ADMIN SECURITY & ACTIONS ===
    function showPasswordPrompt(action, data = null) {
        currentAction = { action, data };
        document.getElementById('passwordPrompt').style.display = 'flex';
        document.getElementById('adminPasswordInput').focus();
    }
    
    function hidePasswordPrompt() {
        document.getElementById('passwordPrompt').style.display = 'none';
        document.getElementById('adminPasswordInput').value = '';
        document.getElementById('passwordError').style.display = 'none';
    }

    function verifyPassword() {
        if (document.getElementById('adminPasswordInput').value === ADMIN_PASSWORD) {
            // Execute the action that required the password
            switch (currentAction.action) {
                case 'adminPanelSection':
                    toggleSection('adminPanelSection');
                    break;
                case 'addProduct':
                    addProduct();
                    break;
                case 'deleteProduct':
                    deleteProduct(currentAction.data);
                    break;
            }
            hidePasswordPrompt();
        } else {
            document.getElementById('passwordError').style.display = 'block';
        }
    }
    
    function saveStoreSettings() {
        settings.storeName = document.getElementById('setStoreName').value || 'Sharif.com';
        settings.currency = document.getElementById('setCurrency').value || '₹';
        localStorage.setItem('settings', JSON.stringify(settings));
        updateStoreName();
        alert('Settings saved!');
    }

    function updateStoreName() {
        document.getElementById('storeName').textContent = settings.storeName;
        document.title = `${settings.storeName} — E-commerce`;
    }
    
    // === Placeholders for future advanced features ===
    // These functions can be built out later using the structures provided.
    function setupAIChatbot() { console.log("AI Chatbot feature to be implemented."); }
    function getRecommendations() { console.log("AI Recommendations feature to be implemented."); }
    function registerVendor() { console.log("Multi-vendor registration feature to be implemented."); }
    
    </script>
    
    <script type="text/javascript">
        var Tawk_API = Tawk_API || {}, Tawk_LoadStart = new Date();
        (function() {
            var s1 = document.createElement("script"), s0 = document.getElementsByTagName("script")[0];
            s1.async = true;
            s1.src = 'https://embed.tawk.to/68a0ca46fd9185192420285b/default';
            s1.charset = 'UTF-8';
            s1.setAttribute('crossorigin', '*');
            s0.parentNode.insertBefore(s1, s0);
        })();
    </script>
    </body>
</html>
