<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sharif.com â€” Admin Panel</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f5f6f8; }
    header { background: #007bff; color: #fff; padding: 12px; }
    .nav { display: flex; align-items: center; gap: 12px; padding: 0 16px; }
    .logo { font-weight: 800; font-size: 20px; }
    .bar { display: flex; gap: 10px; }
    .btn { background: #fff; color: #007bff; border: 0; border-radius: 8px; padding: 10px 20px; font-weight: 700; cursor: pointer; width: 100%; max-width: 200px; }
    .btn.ghost { background: transparent; color: #fff; border: 1px solid rgba(255, 255, 255, .5); }
    .wrap { padding: 16px; max-width: 1200px; margin: 0 auto; }
    .setgrid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
    .setgrid input, .setgrid textarea { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd; }
    #imagePreview { margin-top: 10px; max-width: 200px; display: none; }
    @media (max-width: 768px) { .nav { flex-direction: column; } .bar { flex-direction: column; } .setgrid { grid-template-columns: 1fr; } .btn { max-width: 100%; } }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
  <script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>
</head>
<body>
  <header>
    <div class="nav">
      <div class="logo">Sharif.com</div>
      <div class="bar">
        <a href="index.html" class="btn ghost">Back to Home</a>
      </div>
    </div>
  </header>
  <main class="wrap">
    <h2>Add Product</h2>
    <div class="setgrid">
      <div><input type="text" placeholder="Product Title" id="adminTitle" required /></div>
      <div><input type="text" placeholder="Brand" id="adminBrand" required /></div>
      <div style="grid-column:1/-1"><textarea placeholder="Description" id="adminDescription" required></textarea></div>
      <div><input type="number" placeholder="Price" id="adminPrice" required /></div>
      <div style="grid-column:1/-1">
        <input type="file" id="imageInput" accept="image/*" style="display:none;" />
        <button id="uploadWidget" class="btn" onclick="triggerFileInput()">Select Image from Gallery</button>
        <img id="imagePreview" src="" alt="Image Preview" />
        <input type="hidden" id="adminImage" />
      </div>
    </div>
    <button class="btn" onclick="addProduct()">Add Product</button>
  </main>
  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyD8pAE_mquNZTUujvEK-1v9xmDsUohdYcQ",
      authDomain: "sharifcom-45d95.firebaseapp.com",
      projectId: "sharifcom-45d95",
      storageBucket: "sharifcom-45d95.firebasestorage.app",
      messagingSenderId: "273914972899",
      appId: "1:273914972899:web:65e17d821111e4ac64d3d6",
      measurementId: "G-GZWZ52NDS1"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Cloudinary Config
    const cloudinary = window.cloudinary;
    if (!cloudinary) {
      console.error('Cloudinary script not loaded.');
      alert('Cloudinary is not working. Check your internet or refresh the page.');
    }

    // Trigger File Input
    function triggerFileInput() {
      document.getElementById('imageInput').click();
    }

    // Handle File Selection and Upload
    document.getElementById('imageInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const preview = document.getElementById('imagePreview');
        preview.src = URL.createObjectURL(file);
        preview.style.display = 'block';

        const formData = new FormData();
        formData.append('file', file);
        formData.append('upload_preset', 'Sharif'); // Replace with your upload preset
        formData.append('cloud_name', 'dwf3tkkrg'); // Replace with your cloud name

        fetch('https://api.cloudinary.com/v1_1/dwf3tkkrg/image/upload', {
          method: 'POST',
          body: formData
        })
        .then(response => response.json())
        .then(data => {
          if (data.secure_url) {
            document.getElementById('adminImage').value = data.secure_url;
            console.log('Image uploaded:', data.secure_url);
          } else {
            alert('Image upload failed. Check console.');
            console.error('Upload error:', data);
          }
        })
        .catch(error => {
          alert('Error uploading image. Check console.');
          console.error('Error:', error);
        });
      }
    });

    // Add Product to Firebase
    function addProduct() {
      const title = document.getElementById('adminTitle').value;
      const brand = document.getElementById('adminBrand').value;
      const description = document.getElementById('adminDescription').value;
      const price = parseFloat(document.getElementById('adminPrice').value);
      const image = document.getElementById('adminImage').value;

      if (!title || !brand || !description || !price || !image) {
        alert('Please fill all fields and upload an image!');
        return;
      }

      const product = {
        title: title,
        brand: brand,
        description: description,
        price: price,
        image: image,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      };

      db.collection('products').add(product)
        .then(() => {
          alert('Product added successfully!');
          document.getElementById('adminTitle').value = '';
          document.getElementById('adminBrand').value = '';
          document.getElementById('adminDescription').value = '';
          document.getElementById('adminPrice').value = '';
          document.getElementById('adminImage').value = '';
          document.getElementById('imagePreview').style.display = 'none';
        })
        .catch(error => {
          console.error('Error adding product:', error);
          alert('Failed to add product. Check console.');
        });
    }
  </script>
</body>
</html>